<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Knowledge Graph ‚Äî Architecture</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f8; padding: 30px; }
  h1 { text-align: center; color: #1a1a2e; margin-bottom: 8px; font-size: 26px; }
  .subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }

  .diagram { max-width: 1100px; margin: 0 auto; position: relative; }

  /* Row layout */
  .row { display: flex; justify-content: center; gap: 20px; margin-bottom: 0; position: relative; }
  .row.sources { margin-bottom: 15px; }

  /* Section labels */
  .section-label {
    text-align: center; font-size: 11px; font-weight: 700; text-transform: uppercase;
    letter-spacing: 2px; color: #fff; padding: 6px 20px; border-radius: 20px;
    margin: 0 auto 12px; width: fit-content;
  }

  /* Boxes */
  .box {
    border-radius: 12px; padding: 16px 20px; text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s;
    position: relative; min-width: 160px;
  }
  .box:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.15); }
  .box .icon { font-size: 28px; margin-bottom: 6px; }
  .box .title { font-weight: 700; font-size: 14px; margin-bottom: 3px; }
  .box .desc { font-size: 11px; color: #555; line-height: 1.4; }

  /* Color schemes */
  .source { background: #fff8e1; border: 2px solid #f9a825; }
  .source .title { color: #e65100; }

  .sync { background: #fce4ec; border: 2px dashed #e53935; }
  .sync .title { color: #c62828; }

  .db { background: #e8f5e9; border: 2px solid #43a047; }
  .db .title { color: #2e7d32; }

  .edge-table { background: #f1f8e9; border: 1px solid #7cb342; border-radius: 8px; padding: 8px 14px; font-size: 12px; }

  .api { background: #fff3e0; border: 2px solid #fb8c00; }
  .api .title { color: #e65100; }

  .consumer { background: #ede7f6; border: 2px solid #7e57c2; }
  .consumer .title { color: #4527a0; }

  .current { background: #e8eaf6; border: 2px solid #5c6bc0; }
  .current .title { color: #283593; }

  /* Arrows */
  .arrow-down {
    display: flex; justify-content: center; align-items: center;
    margin: 8px auto; color: #888; font-size: 13px; gap: 8px;
  }
  .arrow-down .line {
    width: 3px; height: 30px; background: linear-gradient(to bottom, #aaa, #666);
    border-radius: 2px; position: relative;
  }
  .arrow-down .line::after {
    content: ''; position: absolute; bottom: -6px; left: -5px;
    border-left: 7px solid transparent; border-right: 7px solid transparent;
    border-top: 8px solid #666;
  }
  .arrow-label {
    font-size: 11px; color: #666; font-weight: 600; background: #f0f4f8;
    padding: 2px 10px; border-radius: 10px; white-space: nowrap;
  }

  /* Wide arrow with label */
  .arrow-section { display: flex; align-items: center; justify-content: center; gap: 12px; margin: 12px 0; }
  .arrow-section .pipe {
    width: 4px; height: 40px; border-radius: 2px; position: relative;
  }
  .arrow-section .pipe::after {
    content: ''; position: absolute; bottom: -7px; left: -6px;
    border-left: 8px solid transparent; border-right: 8px solid transparent;
  }
  .pipe.blue { background: linear-gradient(#64b5f6, #1976d2); }
  .pipe.blue::after { border-top: 9px solid #1976d2; }
  .pipe.orange { background: linear-gradient(#ffb74d, #f57c00); }
  .pipe.orange::after { border-top: 9px solid #f57c00; }
  .pipe.purple { background: linear-gradient(#b39ddb, #7e57c2); }
  .pipe.purple::after { border-top: 9px solid #7e57c2; }
  .pipe.red { background: linear-gradient(#ef9a9a, #e53935); }
  .pipe.red::after { border-top: 9px solid #e53935; }

  /* Section containers */
  .section {
    border-radius: 16px; padding: 20px; margin-bottom: 0;
    border: 2px solid; position: relative;
  }
  .section-title {
    font-size: 16px; font-weight: 700; margin-bottom: 14px;
    display: flex; align-items: center; gap: 8px;
  }

  .section.db-section { background: #f6fbf6; border-color: #a5d6a7; }
  .section.db-section .section-title { color: #2e7d32; }

  .section.api-section { background: #fffbf5; border-color: #ffcc80; }
  .section.api-section .section-title { color: #e65100; }

  /* Edge labels row */
  .edges-row { display: flex; justify-content: center; gap: 12px; margin-top: 12px; flex-wrap: wrap; }
  .edge-chip {
    background: #fff; border: 1px solid #81c784; border-radius: 20px;
    padding: 5px 14px; font-size: 11px; color: #2e7d32; font-weight: 600;
    font-family: 'Consolas', monospace;
  }

  /* Grid for API endpoints */
  .api-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  @media (max-width: 800px) { .api-grid { grid-template-columns: repeat(2, 1fr); } }

  .api-card {
    background: #fff; border: 1px solid #ffcc80; border-radius: 10px;
    padding: 12px; text-align: left;
  }
  .api-card .method { font-size: 10px; font-weight: 700; color: #fff; background: #43a047; padding: 2px 8px; border-radius: 4px; display: inline-block; margin-bottom: 4px; }
  .api-card .path { font-size: 13px; font-weight: 700; color: #e65100; font-family: 'Consolas', monospace; }
  .api-card .api-desc { font-size: 11px; color: #666; margin-top: 4px; }

  /* Consumer row */
  .consumer-row { display: flex; justify-content: center; gap: 30px; }

  /* Legend */
  .legend {
    display: flex; justify-content: center; gap: 20px; margin-top: 30px;
    flex-wrap: wrap; padding: 14px; background: #fff; border-radius: 12px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #444; }
  .legend-dot { width: 14px; height: 14px; border-radius: 4px; border: 2px solid; }

  /* Status badge */
  .badge {
    font-size: 9px; font-weight: 700; padding: 2px 8px; border-radius: 10px;
    position: absolute; top: -8px; right: 10px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .badge.live { background: #c8e6c9; color: #2e7d32; border: 1px solid #81c784; }
  .badge.future { background: #fff9c4; color: #f57f17; border: 1px solid #fdd835; }
  .badge.dummy { background: #e1bee7; color: #7b1fa2; border: 1px solid #ba68c8; }
</style>
</head>
<body>

<h1>QA Knowledge Graph ‚Äî Data Flow Architecture</h1>
<p class="subtitle">How data flows from sources through PostgreSQL to FastAPI and into Cursor AI</p>

<div class="diagram">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROW 1: DATA SOURCES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section-label" style="background: #f9a825;">Data Sources</div>
  <div class="row sources">
    <div class="box source">
      <span class="badge future">Future</span>
      <div class="icon">üé´</div>
      <div class="title">Jira API</div>
      <div class="desc">Requirements<br>Tickets &amp; Status</div>
    </div>
    <div class="box source">
      <span class="badge future">Future</span>
      <div class="icon">üß™</div>
      <div class="title">Zephyr API</div>
      <div class="desc">Test Cases<br>Executions &amp; Results</div>
    </div>
    <div class="box source">
      <span class="badge future">Future</span>
      <div class="icon">‚öôÔ∏è</div>
      <div class="title">CI/CD Pipeline</div>
      <div class="desc">Test Runs<br>Flaky Data</div>
    </div>
    <div class="box current" style="border-style: solid;">
      <span class="badge dummy">Current</span>
      <div class="icon">üìÑ</div>
      <div class="title">seed.sql</div>
      <div class="desc">Dummy Data<br>(5 apps, 16 tickets, 11 tests)</div>
    </div>
  </div>

  <!-- Arrow -->
  <div class="arrow-section">
    <div class="pipe red"></div>
    <span class="arrow-label">Sync Script (Python ‚Äî To Build)</span>
    <div class="pipe blue"></div>
    <span class="arrow-label">INSERT / UPDATE</span>
    <div class="pipe blue"></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROW 2: POSTGRESQL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section db-section">
    <div class="section-title">üêò PostgreSQL + pgvector &nbsp;‚Äî&nbsp; <span style="font-weight:400; font-size:13px;">kg-postgres (Docker, port 5433)</span></div>
    <div class="row">
      <div class="box db">
        <div class="icon">üè¢</div>
        <div class="title">applications</div>
        <div class="desc">5 apps<br>(auth, orders, inventory...)</div>
      </div>
      <div class="box db">
        <div class="icon">üìã</div>
        <div class="title">requirements</div>
        <div class="desc">16 Jira tickets<br>(QA-101 ‚Üí QA-116)</div>
      </div>
      <div class="box db">
        <div class="icon">üß™</div>
        <div class="title">tests</div>
        <div class="desc">11 Playwright tests<br>+ flaky counts</div>
      </div>
      <div class="box db">
        <div class="icon">üîå</div>
        <div class="title">endpoints</div>
        <div class="desc">17 API endpoints<br>(GET, POST, PUT...)</div>
      </div>
      <div class="box db">
        <div class="icon">üìä</div>
        <div class="title">test_results_history</div>
        <div class="desc">Run history<br>pass/fail/error</div>
      </div>
    </div>
    <div class="edges-row">
      <span class="edge-chip">requirement ‚îÄ‚îÄcovered_by‚îÄ‚îÄ‚ñ∂ test</span>
      <span class="edge-chip">test ‚îÄ‚îÄhits‚îÄ‚îÄ‚ñ∂ endpoint</span>
      <span class="edge-chip">endpoint ‚îÄ‚îÄdepends_on‚îÄ‚îÄ‚ñ∂ endpoint</span>
    </div>
  </div>

  <!-- Arrow -->
  <div class="arrow-section">
    <div class="pipe blue"></div>
    <span class="arrow-label">SQL Queries (asyncpg connection pool)</span>
    <div class="pipe blue"></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROW 3: FASTAPI ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section api-section">
    <div class="section-title">‚ö° FastAPI &nbsp;‚Äî&nbsp; <span style="font-weight:400; font-size:13px;">localhost:8000 &nbsp;|&nbsp; Swagger: /docs</span></div>
    <div class="api-grid">
      <div class="api-card">
        <span class="method">GET</span>
        <div class="path">/qa/coverage-gaps</div>
        <div class="api-desc">Requirements with no test coverage, sorted by priority</div>
      </div>
      <div class="api-card">
        <span class="method">GET</span>
        <div class="path">/qa/impact/{jira_key}</div>
        <div class="api-desc">Tests + endpoints affected by a requirement</div>
      </div>
      <div class="api-card">
        <span class="method">GET</span>
        <div class="path">/qa/dependencies/{app_key}</div>
        <div class="api-desc">Cross-app endpoint dependencies (in + out)</div>
      </div>
      <div class="api-card">
        <span class="method">GET</span>
        <div class="path">/qa/flaky-tests</div>
        <div class="api-desc">Unreliable tests with recent run history</div>
      </div>
      <div class="api-card">
        <span class="method">GET</span>
        <div class="path">/qa/app-summary</div>
        <div class="api-desc">All apps with endpoint, test, requirement counts</div>
      </div>
      <div class="api-card">
        <span class="method">GET</span>
        <div class="path">/qa/search?q=</div>
        <div class="api-desc">Text search across requirements and tests</div>
      </div>
    </div>
  </div>

  <!-- Arrow -->
  <div class="arrow-section">
    <div class="pipe purple"></div>
    <span class="arrow-label">JSON Response (HTTP)</span>
    <div class="pipe purple"></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROW 4: CONSUMERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section-label" style="background: #7e57c2;">Consumers</div>
  <div class="consumer-row">
    <div class="box consumer">
      <span class="badge live">Active</span>
      <div class="icon">ü§ñ</div>
      <div class="title">Cursor AI Agent</div>
      <div class="desc">Calls API via curl<br>(.cursor/rules)</div>
    </div>
    <div class="box consumer">
      <span class="badge live">Active</span>
      <div class="icon">üìÑ</div>
      <div class="title">Swagger UI</div>
      <div class="desc">Interactive docs<br>localhost:8000/docs</div>
    </div>
    <div class="box consumer">
      <span class="badge live">Active</span>
      <div class="icon">üîß</div>
      <div class="title">curl / Scripts</div>
      <div class="desc">Terminal access<br>CI integration</div>
    </div>
  </div>

  <!-- Legend -->
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#e8f5e9;border-color:#43a047;"></div> Built &amp; Working</div>
    <div class="legend-item"><div class="legend-dot" style="background:#fff3e0;border-color:#fb8c00;"></div> API Layer (Working)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ede7f6;border-color:#7e57c2;"></div> Consumers (Active)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#fff8e1;border-color:#f9a825;"></div> Data Sources (Future)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#fce4ec;border-color:#e53935;border-style:dashed;"></div> To Build</div>
    <div class="legend-item"><div class="legend-dot" style="background:#e8eaf6;border-color:#5c6bc0;"></div> Dummy Data (Current)</div>
  </div>

</div>

</body>
</html>
